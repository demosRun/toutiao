<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <!-- 页面的元信息 -->
  <title>人民日报</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=1000, user-scalable=yes" />
  <meta name="format-detection" content="telephone=no, email=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="white" />
  <meta name="renderer" content="webkit" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="filetype" content="1" />
  <meta name="publishedtype" content="1" />
  <meta name="pagetype" content="2" />
  <meta name="description" content="{TAG_59447_TAG}" />
  <meta name="keywords" content="{TAG_59446_TAG}" />
  <meta name="catalogs" content="{TAG_83943_TAG}" />

  <!-- 页面主样式文件 -->
  <link charset="utf-8" rel="stylesheet" href="./static/css/owo.core.o9vg580b8vg.css">

  <!-- 附属css文件 -->
  <link rel="stylesheet" href="./static/resource/default.css" charset="utf-8">
  <link rel="stylesheet" href="./static/css/main.css" charset="utf-8">
  <link rel="stylesheet" href="./static/resource/swiper.min.css" charset="utf-8">

</head>

<body>

  <!-- 页面[page]-->
  <div class="dubao-box page" template="page" style="display: block;">
    <div class="no-show" id="menu">
      <div class="menu-bottom clear">
        <div class="menu huaxian" o-tap="huaxian()">划线</div>
        <div class="menu qxhx" o-tap="clear('underline')">取消划线</div>
        <div class="menu beijing" o-tap="beijing()">加背景</div>
        <div class="menu qxbj" o-tap="clear('beijing')">取消背景</div>
        <div class="menu biji" o-tap="biji()">做笔记</div>
        <div class="menu qxbiji" o-tap="clear('memo')">取消笔记</div>
        <div class="menu" o-tap="copyText()">复制</div>
      </div>
    </div>
    <div id="tool-menu">
      <div class="text"></div>
      <div class="tool-clear" o-tap="clear()">清除标记</div>
    </div>
    <div class="home clear main w1000"></div>
    <div class="biji-box shalid">
      <div class="biji-input"><svg onclick="closeInput()" t="1618924850694" class="close" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2020" width="48" height="48">
          <path d="M7.67 512.003C7.67 794.773 234.866 1024 515.126 1024c280.27 0 507.457-229.227 507.457-511.997S795.396 0 515.127 0C234.867 0 7.669 229.233 7.669 512.003z" fill="#858585" p-id="2021"></path>
          <path d="M793.678 233.134c15.083 14.883 15.083 40.913 0 55.802L284.084 791c-15.109 14.853-41.532 14.853-56.636 0-15.083-14.878-15.083-40.919 0-55.802l509.59-502.063c15.108-14.858 41.537-14.858 56.64 0z" fill="#FFFFFF" p-id="2022"></path>
          <path d="M236.585 240.824c14.659-14.409 40.295-14.409 54.954 0L785.994 727.66c14.628 14.434 14.628 39.682 0 54.11-14.66 14.403-40.295 14.403-54.96 0L236.586 294.934c-14.633-14.44-14.633-39.682 0-54.11z" fill="#FFFFFF" p-id="2023"></path>
        </svg>
        <div class="title">查看或编辑您的笔记</div>
        <textarea></textarea>
        <div class="bottom-bar clear">
          <div class="button fl" style="background: #ccc;" o-tap="document.querySelector('.biji-box').style.display = 'none'">取消</div>
          <div class="button fl" style="background: #d03333;" o-tap="clear('memo')">删除</div>
          <div class="button fl" style="background: #1497fc;" o-tap="saveBiji()">保存</div>
        </div>
      </div>
    </div>
    <div class="shouji-box shalid">
      <div class="shouji-input">
        <div class="title">请输入手机号以便保存您的阅读历史:</div>
        <input type="text">
        <div class="button">确认</div>
      </div>
    </div>
  </div>

  <!-- 框架script文件 -->
  <script src="./static/js/owo.core.o9vg580b8vg.js" type="text/javascript" charset="UTF-8"></script>
  <script type="text/javascript" charset="UTF-8">
    owo.script = {
      "page": {
        "data": {
          "activeEl": null,
          "toolHover": false,
          "huaxianIng": false,
          "clickIng": false
        },
        "created": function created(params) {
          var _this = this;

          if (!localStorage.getItem("userInfo")) {
            showPhoneInput(function(e) {
              console.log(e.target);
              userID = document.querySelector('.shouji-input input').value;
              userID = userID + 'pc';
              localStorage.setItem("userInfo", userID);
              document.querySelector('.shouji-box').style.display = 'none';
            });
          } else {
            userID = localStorage.getItem("userInfo");
          }

          if (location.hash) {
            var temp = location.hash.replace('#', '');
            getData(temp);
          } else {
            getData('now');
          }

          this.query('#menu').onmouseover = function(e) {
            _this.data.toolHover = true;
          };

          this.query('#menu').onmouseout = function(e) {
            _this.data.toolHover = false;
            setTimeout(function() {
              if (!_this.data.toolHover && !_this.data.huaxianIng) {
                console.log('关掉菜单!');

                _this.query('#menu').classList.add('no-show');
              }
            }, 500);
          };
        },
        "copyText": function copyText() {
          owo.tool.notice('复制成功!');
        },
        "saveBiji": function saveBiji() {
          document.querySelector('.biji-box').style.display = 'none';

          if (!this.data.activeEl) {
            this.query('#menu').classList.add('no-show');
            return;
          }

          this.data.activeEl.setAttribute('data-val', document.querySelector('.biji-box textarea').value);
          document.querySelector('.biji-box textarea').value = '';
          owo.tool.toast('笔记修改成功!');
        },
        "huaxian": function huaxian() {
          console.log('划线');
          var select = window.getSelection();
          var parentNode = window.getSelection().focusNode.parentNode || window.getSelection().focusNode.parentNode;
          parentNode = parentNode.innerHTML;
          var selectText = etSelectedText();
          console.log(selectText.length);

          if (selectText) {
            parentNode = parentNode.replace(selectText, "<span class=\"dubao underline\">" + selectText + "</span>");
            window.getSelection().focusNode.parentNode.innerHTML = parentNode;
            this.query('#menu').classList.add('no-show');
            this.initText();
            this.save();
          } else {
            owo.tool.toast('未选择内容!');
          }
        },
        "beijing": function beijing() {
          var parentNode = window.getSelection().focusNode.parentNode || window.getSelection().focusNode.parentNode;
          parentNode = parentNode.innerHTML;
          selectText = etSelectedText();

          if (selectText) {
            parentNode = parentNode.replace(selectText, "<span class=\"dubao beijing\">" + selectText + "</span>");
            window.getSelection().focusNode.parentNode.innerHTML = parentNode;
            this.query('#menu').classList.add('no-show');
            this.initText();
            this.save();
          } else {
            owo.tool.toast('未选择内容!');
          }
        },
        "biji": function biji() {
          selectText = etSelectedText();

          if (!selectText) {
            owo.tool.toast('未选择内容!');
            return;
          }

          var parentNode = window.getSelection().focusNode.parentNode || window.getSelection().focusNode.parentNode;
          parentNode = parentNode.innerHTML;
          var word = prompt("请输入笔记内容!", "");
          console.log(word);

          if (word && selectText) {
            parentNode = parentNode.replace(selectText, "<span class=\"dubao memo\">" + selectText + "<i class=\"anno\" data-val=\"" + escape(word) + "\">\u6CE8</i></span>");
            window.getSelection().focusNode.parentNode.innerHTML = parentNode;
            this.query('#menu').classList.add('no-show');
            this.initText();
            this.save();
          }
        },
        "checkDom": function checkDom(target) {
          var _this2 = this;

          this.data.clickIng = true;
          console.log('选择元素');
          console.log($(target));

          if ($(target).hasClass("beijing") || $(target).find('.beijing')[0]) {
            document.querySelector('#menu .beijing').style.display = 'none';
            document.querySelector('#menu .qxbj').style.display = 'block';
          } else {
            document.querySelector('#menu .beijing').style.display = 'block';
            document.querySelector('#menu .qxbj').style.display = 'none';
          }

          if ($(target).hasClass("underline") || $(target).find('.underline')[0]) {
            document.querySelector('#menu .huaxian').style.display = 'none';
            document.querySelector('#menu .qxhx').style.display = 'block';
          } else {
            document.querySelector('#menu .huaxian').style.display = 'block';
            document.querySelector('#menu .qxhx').style.display = 'none';
          }

          if ($(target).hasClass("anno")) {
            document.querySelector('.biji-box').style.display = 'block';
            document.querySelector('.biji-input textarea').value = unescape(target.getAttribute('data-val'));
            setTimeout(function() {
              document.querySelector('#menu').classList.add('no-show');
            }, 0);
            return;
          }

          var memo = $(target)[0] || $(target).find('.memo')[0];

          if ($(target).hasClass("memo")) {
            document.querySelector('#menu .biji').style.display = 'none';
            document.querySelector('#menu .qxbiji').style.display = 'block';
          } else {
            this.data.showText = false;
            document.querySelector('#menu .biji').style.display = 'block';
            document.querySelector('#menu .qxbiji').style.display = 'none';
          }

          setTimeout(function() {
            _this2.data.clickIng = false;
          }, 100);
        },
        "initText": function initText() {
          var _this3 = this;

          console.log('重新生成!');

          var _loop = function _loop(index) {
            var element = _this3.queryAll('.article .dubao')[index];

            var menu = document.querySelector('#menu');

            element.onclick = function(e) {
              _this3.data.toolHover = true;
              _this3.data.activeEl = e.target;

              _this3.checkDom(e.target);

              menu.style.left = e.layerX - 100 + 'px';

              if (_this3.data.showText) {
                setTimeout(function() {
                  menu.style.bottom = document.body.clientHeight - e.pageY - 10 - 30 + 'px';
                }, 0);
              } else {
                menu.style.bottom = document.body.clientHeight - e.pageY - 10 - 50 + 'px';
              }

              _this3.query('#menu').classList.remove('no-show');
            }; // element.onmouseout = (e) => {
            //   this.data.toolHover = false
            //   setTimeout(() => {
            //     if (!this.data.toolHover && !this.data.huaxianIng) {
            //       console.log('关掉菜单2!')
            //       this.query('#menu').classList.add('no-show')
            //     }
            //   }, 500);
            // }

          };

          for (var index = 0; index < this.queryAll('.article .dubao').length; index++) {
            _loop(index);
          }

          this.queryAll('.article .dubao');

          if (document.querySelector('#go-top')) {
            document.querySelector('#go-top').onclick = function() {
              document.body.scrollTop = document.documentElement.scrollTop = 0;
            };
          } // console.log(document.querySelector('.right.nav'))


          if (document.querySelector('.right.nav')) {
            document.querySelector('.right.nav').innerHTML = '<li id="my" onclick="wode()">我的空间</li>';
          }
        },
        "initPaper": function initPaper() {
          var _this4 = this;

          // document.querySelector('.article').oncontextmenu=function(e){
          //   //取消默认的浏览器自带右键 很重要！！
          //   e.preventDefault();
          //   //获取我们自定义的右键菜单
          //   var menu=document.querySelector("#menu");
          //   //根据事件对象中鼠标点击的位置，进行定位
          //   menu.style.left=e.clientX+'px';
          //   menu.style.top=e.clientY+'px';
          //   //改变自定义菜单的高宽，让它显示出来
          //   menu.style.height='125px';
          // }
          if (document.querySelector('.article-box .article')) {
            document.querySelector('.article-box .article').onmouseup = function(e) {
              setTimeout(function() {
                if (_this4.data.clickIng) return;
                _this4.data.huaxianIng = true;
                var selectText = etSelectedText();

                if (selectText.length > 0 || $(e.target).hasClass("dubao")) {
                  var parentNode = window.getSelection().focusNode.parentNode || window.getSelection().focusNode.parentNode;
                  var leftStart = window.getSelection().anchorOffset; // console.log(parentNode)
                  // console.log(selectText.length)

                  var parent = window.getSelection().baseNode ? window.getSelection().baseNode : window.getSelection().focusNode; // console.log(etSelectedText())

                  _this4.checkDom(parent);

                  var selectTextTemp = parent.parentNode.innerText || parent.data;
                  var textIndex = selectTextTemp.indexOf(selectTextTemp);
                  _this4.query('#menu').style.left = e.layerX - 100 + 'px'; // console.log(e)

                  _this4.query('#menu').style.bottom = document.body.clientHeight - e.pageY - 60 + 'px';
                  document.querySelector('#tool-menu').style.display = 'none';

                  _this4.query('#menu').classList.remove('no-show');

                  setTimeout(function() {
                    if (!_this4.data.toolHover && !_this4.data.huaxianIng) {
                      _this4.data.huaxianIng = false;
                      console.log('关掉菜单3!');

                      _this4.query('#menu').classList.add('no-show');
                    }
                  }, 2000);
                } else {
                  _this4.query('#menu').classList.add('no-show');
                }
              }, 0);
            };
          }

          this.initText();
        },
        "langdu": function langdu() {
          var selectText = document.querySelector('#ozoom').innerText;
          var myHeaders = new Headers();
          myHeaders.append("Content-Type", "text/plain");
          var raw = selectText;
          var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
          };
          $.ajax({
            "url": "http://154.8.196.163:5000/",
            "method": "GET",
            "timeout": 0
          }).done(function(response) {
            var audio = new Audio("http://154.8.196.163:5000/" + response); //这里的路径写上mp3文件在项目中的绝对路径

            audio.play(); //播放
          });
          this.query('#menu').classList.add('no-show');
        },
        "clear": function clear(classStr) {
          if (!this.data.activeEl) {
            this.query('#menu').classList.add('no-show');
            return;
          }

          console.log(this.data.activeEl);

          if ($(this.data.activeEl).hasClass(classStr)) {
            this.data.activeEl.outerHTML = this.data.activeEl.innerHTML;
          }

          this.query('#menu').classList.add('no-show');
          console.log('---------------');
          console.log(classStr);
          console.log(this.data.activeEl);
          this.data.activeEl.querySelectorAll('.' + classStr).forEach(function(element) {
            console.log('---------------');
            console.log(element);
            element.outerHTML = element.innerHTML;
          });
          this.save();
          this.initText();
          document.querySelector('.biji-box').style.display = 'none';
        },
        "tingquanwen": function tingquanwen() {
          var selectText = document.querySelector('#ozoom').innerText;
          var audio = new Audio("http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&spd=4&text=" + selectText); //这里的路径写上mp3文件在项目中的绝对路径

          audio.play(); //播放
        },
        "save": function save() {
          $.ajax({
            "url": "http://service-b39yklt6-1256763111.gz.apigw.tencentcs.com/release/saveAll/" + userID + "/" + activePart,
            "method": "POST",
            "timeout": 0,
            "data": document.querySelector('.home').innerHTML,
            "success": function success(response) {
              owo.tool.toast('数据保存成功!');
            }
          });
        }
      }
    };
  </script>

  <script src="./static/js/idangerous.swiper2.7.6.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/jquery-1.11.1.min.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/main.js" type="text/javascript" charset="UTF-8"></script>

  <script src="./static/js/notice.js" type="text/javascript" charset="UTF-8"></script>
  <script src="./static/js/toast.js" type="text/javascript" charset="UTF-8"></script>
</body>

</html>